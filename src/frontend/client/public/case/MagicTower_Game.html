<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>é­”å¡”ç½‘é¡µæ¸¸æˆ</title>
  <style>
    body { font-family: 'å¾®è½¯é›…é»‘', Arial, sans-serif; background: #222; color: #eee; margin: 0; }
    .container { display: flex; flex-direction: row; max-width: 900px; margin: 30px auto; background: #333; border-radius: 8px; box-shadow: 0 0 16px #111; }
    .map-area { display: grid; grid-template-columns: repeat(11, 32px); grid-template-rows: repeat(11, 32px); gap: 1px; background: #222; margin: 20px; border: 2px solid #444; }
    .cell { width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; font-size: 18px; border-radius: 3px; }
    .side-bar { width: 220px; background: #222; padding: 18px 12px; border-left: 2px solid #444; display: flex; flex-direction: column; }
    .attr-panel { margin-bottom: 18px; }
    .attr-panel h3 { margin: 0 0 8px 0; font-size: 18px; }
    .attr-list { font-size: 15px; line-height: 1.7; }
    .log-panel { flex: 1; background: #181818; margin-bottom: 12px; padding: 8px; border-radius: 4px; font-size: 13px; overflow-y: auto; max-height: 180px; }
    .ctrl-panel { display: flex; flex-direction: column; align-items: center; }
    .ctrl-row { display: flex; flex-direction: row; margin: 2px 0; }
    .ctrl-btn { width: 38px; height: 38px; margin: 0 2px; background: #444; color: #fff; border: none; border-radius: 5px; font-size: 20px; cursor: pointer; transition: background 0.2s; }
    .ctrl-btn:hover { background: #666; }
    .floor-info { margin: 8px 0 12px 0; font-size: 16px; text-align: center; }
    .game-title { text-align: center; font-size: 28px; margin: 18px 0 0 0; letter-spacing: 2px; color: #ffeb3b; text-shadow: 1px 2px 6px #000; }
    .desc { font-size: 13px; color: #bbb; margin-top: 8px; text-align: center; }
    .modal { position: fixed; left: 0; top: 0; width: 100vw; height: 100vh; background: rgba(0,0,0,0.7); display: flex; align-items: center; justify-content: center; z-index: 99; }
    .modal-content { background: #222; padding: 32px 40px; border-radius: 10px; text-align: center; color: #fff; font-size: 20px; box-shadow: 0 0 24px #000; }
    .modal-btn { margin-top: 18px; padding: 8px 24px; font-size: 16px; background: #ffeb3b; color: #222; border: none; border-radius: 5px; cursor: pointer; }
    .modal-btn:hover { background: #ffe066; }
  </style>
</head>
<body>
  <div class="game-title">é­”å¡”ç½‘é¡µæ¸¸æˆ</div>
  <div class="container">
    <div class="map-area" id="mapArea"></div>
    <div class="side-bar">
      <div class="floor-info" id="floorInfo"></div>
      <div class="attr-panel">
        <h3>è§’è‰²å±æ€§</h3>
        <div class="attr-list" id="attrList"></div>
      </div>
      <div class="log-panel" id="logPanel"></div>
      <div class="ctrl-panel">
        <div class="ctrl-row">
          <button class="ctrl-btn" id="btnUp">â†‘</button>
        </div>
        <div class="ctrl-row">
          <button class="ctrl-btn" id="btnLeft">â†</button>
          <button class="ctrl-btn" id="btnDown">â†“</button>
          <button class="ctrl-btn" id="btnRight">â†’</button>
        </div>
        <div class="ctrl-row">
          <button class="ctrl-btn" id="btnRestart" title="é‡å¼€">âŸ³</button>
        </div>
      </div>
      <div class="desc">æ–¹å‘é”®æˆ–æŒ‰é’®æ§åˆ¶ç§»åŠ¨ï¼Œæ”¶é›†é“å…·ï¼ŒæŒ‘æˆ˜æ€ªç‰©ï¼Œç™»é¡¶é­”å¡”ï¼</div>
    </div>
  </div>
  <div id="modal" class="modal" style="display:none;">
    <div class="modal-content" id="modalContent"></div>
  </div>
<script>
// ====== æ¸¸æˆæ•°æ®å®šä¹‰ï¼ˆæ ¹æ®é…ç½®è‡ªåŠ¨ç”Ÿæˆï¼‰ ======
const GAME_CONFIG = {
  numberOfFloors: 3,
  monsterTypes: [
    { name: 'å²è±å§†', hp: 50, atk: 10, def: 5, gold: 1, exp: 1, icon: 'ğŸŸ¢' },
    { name: 'è™è ', hp: 80, atk: 18, def: 8, gold: 2, exp: 2, icon: 'ğŸ¦‡' },
    { name: 'éª·é«…', hp: 120, atk: 25, def: 12, gold: 3, exp: 3, icon: 'ğŸ’€' }
  ],
  itemTypes: [
    { name: 'é»„é’¥åŒ™', type: 'key', color: 'yellow', icon: 'ğŸ”‘' },
    { name: 'è¡€ç“¶', type: 'hp', value: 50, icon: 'ğŸ§ª' },
    { name: 'æ”»å‡»å®çŸ³', type: 'atk', value: 5, icon: 'ğŸ’' }
  ]
};
// åœ°å›¾ç¬¦å·å®šä¹‰
const SYMBOLS = {
  wall: 'â¬›',
  floor: 'â¬œ',
  player: 'ğŸ§‘',
  upStair: 'ğŸ”¼',
  downStair: 'ğŸ”½',
  slime: 'ğŸŸ¢',
  bat: 'ğŸ¦‡',
  skeleton: 'ğŸ’€',
  yellowKey: 'ğŸ”‘',
  hpBottle: 'ğŸ§ª',
  atkGem: 'ğŸ’'
};
// ç”Ÿæˆ3å±‚åœ°å›¾ï¼ˆ11x11ï¼‰ï¼Œæ¯å±‚æœ‰æ€ªç‰©ã€é“å…·ã€æ¥¼æ¢¯
function genMapData() {
  const floors = [];
  for(let f=0; f<GAME_CONFIG.numberOfFloors; f++) {
    // åŸºç¡€å…¨å¢™
    let map = Array.from({length:11},()=>Array(11).fill('wall'));
    // å¼€æ”¾åŒºåŸŸ
    for(let y=1; y<10; y++) for(let x=1; x<10; x++) map[y][x]='floor';
    // ä¸Šä¸‹æ¥¼æ¢¯
    if(f===0) map[1][1]='upStair';
    else if(f===GAME_CONFIG.numberOfFloors-1) map[9][9]='downStair';
    else { map[1][1]='upStair'; map[9][9]='downStair'; }
    // æ€ªç‰©
    let monsters = ['slime','bat','skeleton'];
    for(let i=0;i<2+f;i++) {
      let m = monsters[Math.floor(Math.random()*monsters.length)];
      let px = 2+Math.floor(Math.random()*7), py = 2+Math.floor(Math.random()*7);
      if(map[py][px]==='floor') map[py][px]=m;
    }
    // é“å…·
    let items = ['yellowKey','hpBottle','atkGem'];
    for(let i=0;i<2;i++) {
      let it = items[Math.floor(Math.random()*items.length)];
      let px = 2+Math.floor(Math.random()*7), py = 2+Math.floor(Math.random()*7);
      if(map[py][px]==='floor') map[py][px]=it;
    }
    floors.push(map);
  }
  return floors;
}
const MAPS = genMapData();
// ====== è§’è‰²ä¸çŠ¶æ€ ======
const INIT_PLAYER = {
  x: 5, y: 9, floor: 0,
  hp: 200, atk: 20, def: 10,
  yellowKey: 0, gold: 0, exp: 0
};
let player = {};
let gameState = { status: 'playing', log: [] };
// ====== æ€ªç‰©/é“å…·å±æ€§æŸ¥æ‰¾ ======
function getMonster(type) {
  return GAME_CONFIG.monsterTypes.find(m=>{
    if(type==='slime') return m.name==='å²è±å§†';
    if(type==='bat') return m.name==='è™è ';
    if(type==='skeleton') return m.name==='éª·é«…';
    return false;
  });
}
function getItem(type) {
  if(type==='yellowKey') return GAME_CONFIG.itemTypes[0];
  if(type==='hpBottle') return GAME_CONFIG.itemTypes[1];
  if(type==='atkGem') return GAME_CONFIG.itemTypes[2];
  return null;
}
// ====== UIæ¸²æŸ“ ======
function renderMap() {
  const area = document.getElementById('mapArea');
  area.innerHTML = '';
  let map = MAPS[player.floor];
  for(let y=0;y<11;y++) for(let x=0;x<11;x++) {
    let cell = document.createElement('div');
    cell.className = 'cell';
    let v = (x===player.x && y===player.y)?'player':map[y][x];
    cell.textContent = SYMBOLS[v]||SYMBOLS.floor;
    area.appendChild(cell);
  }
}
function renderAttr() {
  const attr = document.getElementById('attrList');
  attr.innerHTML = `ç”Ÿå‘½: ${player.hp}<br>æ”»å‡»: ${player.atk}<br>é˜²å¾¡: ${player.def}<br>é»„é’¥åŒ™: ${player.yellowKey}<br>é‡‘å¸: ${player.gold}<br>ç»éªŒ: ${player.exp}`;
}
function renderFloor() {
  document.getElementById('floorInfo').textContent = `ç¬¬${player.floor+1}å±‚ / å…±${GAME_CONFIG.numberOfFloors}å±‚`;
}
function renderLog() {
  const log = document.getElementById('logPanel');
  log.innerHTML = gameState.log.slice(-10).map(l=>`<div>${l}</div>`).join('');
  log.scrollTop = log.scrollHeight;
}
function showModal(msg, restart=false) {
  const modal = document.getElementById('modal');
  const content = document.getElementById('modalContent');
  content.innerHTML = msg + (restart?'<br><button class="modal-btn" onclick="restartGame()">é‡æ–°å¼€å§‹</button>':'');
  modal.style.display = 'flex';
}
function hideModal() {
  document.getElementById('modal').style.display = 'none';
}
// ====== æ¸¸æˆä¸»é€»è¾‘ ======
function canMove(nx,ny) {
  if(nx<0||nx>10||ny<0||ny>10) return false;
  let v = MAPS[player.floor][ny][nx];
  if(v==='wall') return false;
  return true;
}
function move(dx,dy) {
  if(gameState.status!=='playing') return;
  let nx=player.x+dx, ny=player.y+dy;
  if(!canMove(nx,ny)) {
    gameState.log.push('æ’å¢™äº†ï¼');
    renderLog();
    return;
  }
  let cell = MAPS[player.floor][ny][nx];
  // æ€ªç‰©
  if(['slime','bat','skeleton'].includes(cell)) {
    let m = getMonster(cell);
    let dmg = Math.max(0, m.atk-player.def);
    let rounds = Math.ceil(m.hp/Math.max(1,player.atk-m.def));
    let totalDmg = dmg*rounds;
    if(player.hp>totalDmg) {
      player.hp -= totalDmg;
      player.gold += m.gold;
      player.exp += m.exp;
      gameState.log.push(`å‡»è´¥${m.name}ï¼ŒæŸå¤±${totalDmg}ç”Ÿå‘½ï¼Œè·å¾—${m.gold}é‡‘å¸ã€${m.exp}ç»éªŒã€‚`);
      MAPS[player.floor][ny][nx]='floor';
    } else {
      gameState.log.push(`ä¸${m.name}æˆ˜æ–—å¤±è´¥ï¼`);
      renderLog();
      gameOver(false);
      return;
    }
  }
  // é“å…·
  if(['yellowKey','hpBottle','atkGem'].includes(cell)) {
    let it = getItem(cell);
    if(it.type==='key') { player.yellowKey++; gameState.log.push('è·å¾—é»„é’¥åŒ™ï¼'); }
    if(it.type==='hp') { player.hp+=it.value; gameState.log.push(`è·å¾—è¡€ç“¶ï¼Œç”Ÿå‘½+${it.value}`); }
    if(it.type==='atk') { player.atk+=it.value; gameState.log.push(`è·å¾—æ”»å‡»å®çŸ³ï¼Œæ”»å‡»+${it.value}`); }
    MAPS[player.floor][ny][nx]='floor';
  }
  // æ¥¼æ¢¯
  if(cell==='upStair') {
    if(player.floor<GAME_CONFIG.numberOfFloors-1) {
      player.floor++;
      gameState.log.push('ä½ ç™»ä¸Šäº†æ›´é«˜ä¸€å±‚ï¼');
      // ä¼ é€åˆ°èµ·ç‚¹
      player.x=5; player.y=9;
      renderAll();
      return;
    }
  }
  if(cell==='downStair') {
    if(player.floor>0) {
      player.floor--;
      gameState.log.push('ä½ å›åˆ°äº†ä¸‹å±‚ã€‚');
      player.x=5; player.y=9;
      renderAll();
      return;
    }
  }
  // æ™®é€šç§»åŠ¨
  player.x=nx; player.y=ny;
  renderAll();
}
function gameOver(win) {
  gameState.status = 'over';
  if(win) showModal('æ­å–œä½ ï¼ŒæˆåŠŸç™»é¡¶é­”å¡”ï¼',true);
  else showModal('ä½ å¤±è´¥äº†ï¼Œå‹‡å£«ï¼',true);
}
function checkWin() {
  // ç»ˆç‚¹ï¼šæœ€åä¸€å±‚å³ä¸‹è§’
  if(player.floor===GAME_CONFIG.numberOfFloors-1 && player.x===9 && player.y===9) {
    gameOver(true);
  }
}
function restartGame() {
  hideModal();
  Object.assign(player, INIT_PLAYER);
  gameState.status = 'playing';
  gameState.log = ['æ¸¸æˆé‡æ–°å¼€å§‹ï¼'];
  renderAll();
}
function renderAll() {
  renderMap();
  renderAttr();
  renderFloor();
  renderLog();
  checkWin();
}
// ====== äº‹ä»¶ç»‘å®š ======
document.addEventListener('keydown', e=>{
  if(gameState.status!=='playing') return;
  if(e.key==='ArrowUp') move(0,-1);
  if(e.key==='ArrowDown') move(0,1);
  if(e.key==='ArrowLeft') move(-1,0);
  if(e.key==='ArrowRight') move(1,0);
});
document.getElementById('btnUp').onclick = ()=>move(0,-1);
document.getElementById('btnDown').onclick = ()=>move(0,1);
document.getElementById('btnLeft').onclick = ()=>move(-1,0);
document.getElementById('btnRight').onclick = ()=>move(1,0);
document.getElementById('btnRestart').onclick = ()=>restartGame();
document.getElementById('modal').onclick = function(e){ if(e.target===this) hideModal(); };
// ====== åˆå§‹åŒ– ======
window.onload = function() {
  Object.assign(player, INIT_PLAYER);
  gameState.log = ['æ¸¸æˆå¼€å§‹ï¼'];
  renderAll();
};
</script>
</body>
</html>
