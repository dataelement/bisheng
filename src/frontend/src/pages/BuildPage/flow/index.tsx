import { TabsContext } from "@/contexts/tabsContext";
import { getFlowApi } from "@/controllers/API/flow";
import cloneDeep from "lodash-es/cloneDeep";
import { useContext, useEffect, useMemo } from "react";
import { useParams } from "react-router-dom";
import Panne from "./Panne";
import useFlowStore from "./flowStore";
import { userContext } from "@/contexts/userContext";

const test = {"nodes":[{"id":"start_a030e","type":"flowNode","position":{"x":-1256.7006243933397,"y":224.1154227909051},"data":{"id":"start_a030e","name":"å¼€å§‹","description":"å·¥ä½œæµè¿è¡Œçš„èµ·å§‹èŠ‚ç‚¹","type":"start","group_params":[{"name":"å¼€åœºå¼•å¯¼","params":[{"key":"guide_word","label":"å¼€åœºç™½","value":"ä½ å¥½ï¼Œæˆ‘æ˜¯æ¯•æ˜‡ workflow å†…æµ‹ä½“éªŒç‰ˆï¼Œç›®å‰æ”¯æŒ 6 ä¸ªèŠ‚ç‚¹è¿›è¡Œä»»åŠ¡ç¼–æŽ’ï¼šå¼€å§‹ã€è¾“å…¥ã€è¾“å‡ºã€å¤§æ¨¡åž‹ã€RAGã€ç»“æŸï¼ˆå…¶ä½™èŠ‚ç‚¹æš‚ä¸æ”¯æŒï¼‰ã€‚\n\nè®©æˆ‘ä»¬é€šè¿‡æ‹ sam Altman å½©è™¹å±æ¥å¼€å¯å†…æµ‹ä½“éªŒä¹‹æ—…å§","type":"textarea"},{"key":"guide_question","label":"å¼•å¯¼é—®é¢˜","value":[""],"type":"input_list","help":"ä¸ºç”¨æˆ·æä¾›æŽ¨èé—®é¢˜ï¼Œå¼•å¯¼ç”¨æˆ·è¾“å…¥ï¼Œè¶…è¿‡3ä¸ªæ—¶å°†éšæœºé€‰å–3ä¸ª"}]},{"name":"å…¨å±€å˜é‡","params":[{"key":"current_time","global":"key","label":"å½“å‰æ—¶é—´","type":"var","value":""},{"key":"chat_history","global":"key","type":"chat_history_num","value":10},{"key":"preset_question","label":"é¢„ç½®é—®é¢˜åˆ—è¡¨","global":"index","type":"input_list","value":[]}]}]},"selected":false,"positionAbsolute":{"x":411,"y":157},"dragging":false,"measured":{"width":324,"height":599}},{"id":"input_8f3ba","type":"flowNode","position":{"x":651.714642982112,"y":2.0485297782731635},"data":{"id":"input_8f3ba","name":"è¾“å…¥","description":"å·¥ä½œæµè¿è¡Œåˆ°æ­¤ç»“æŸ","type":"input","tab":{"value":"input","options":[{"label":"å¯¹è¯æ¡†è¾“å…¥","key":"input"},{"label":"è¡¨å•è¾“å…¥","key":"form"}]},"group_params":[{"name":"è¾“å…¥","params":[{"key":"user_input","global":"key","label":"ç”¨æˆ·è¾“å…¥çš„å†…å®¹","type":"var","tab":"input"},{"global":"code:value.map(el => ({ label: el.key, value: el.key }))","key":"form_input","label":"+ æ·»åŠ è¡¨å•é¡¹","type":"form","value":[{"key":"category","type":"select","value":"ç±»åˆ«","required":true,"multi":false,"options":[{"id":"5a041ee4","text":"1","type":""},{"id":"94d94f59","text":"2","type":""},{"id":"4c1c8146","text":"3","type":""}]},{"key":"text_input","type":"text","value":"å§“å","required":true,"multi":false,"options":[]}],"tab":"form"}]}]},"measured":{"width":324,"height":268},"selected":false,"dragging":false},{"id":"output_58058","type":"flowNode","position":{"x":-646.2224617672917,"y":166.9599710384927},"data":{"id":"output_58058","name":"è¾“å‡º","description":"å¯å‘ç”¨æˆ·å‘é€æ¶ˆæ¯ï¼Œå¹¶ä¸”æ”¯æŒè¿›è¡Œæ›´ä¸°å¯Œçš„äº¤äº’ï¼Œä¾‹å¦‚è¯·æ±‚ç”¨æˆ·æ‰¹å‡†è¿›è¡ŒæŸé¡¹æ•æ„Ÿæ“ä½œã€å…è®¸ç”¨æˆ·åœ¨æ¨¡åž‹è¾“å‡ºå†…å®¹çš„åŸºç¡€ä¸Šç›´æŽ¥ä¿®æ”¹å¹¶æäº¤","type":"output","group_params":[{"params":[{"key":"output_msg","label":"å‘é€æ¶ˆæ¯å†…å®¹","type":"var_textarea_file","value":{"msg":"ä½ è§‰å¾— Sam Altman å€¼å¾—æ‹å½©è™¹å±å—","files":[]}},{"key":"output_way","label":"äº¤äº’ç±»åž‹","global":"value.type=input","type":"output_form","value":{"type":"choose","value":""},"options":[{"id":"db066c82","label":"å€¼å¾—","value":""},{"id":"6f7f86cb","label":"ä¸å€¼å¾—","value":""},{"id":"05289333","label":"æˆ‘ä¸çŸ¥é“","value":""},{"id":"f138d2c3","label":"é—²èŠï¼ˆæ— é™èŠå¤©æ¨¡å¼ï¼Œå»ºè®®æœ€åŽä½“éªŒï¼‰","value":""}]}]}]},"measured":{"width":324,"height":717},"selected":false,"dragging":false},{"id":"output_ddeac","type":"flowNode","position":{"x":227.77445791201478,"y":-89.13389468690075},"data":{"id":"output_ddeac","name":"è¾“å‡º1","description":"å¯å‘ç”¨æˆ·å‘é€æ¶ˆæ¯ï¼Œå¹¶ä¸”æ”¯æŒè¿›è¡Œæ›´ä¸°å¯Œçš„äº¤äº’ï¼Œä¾‹å¦‚è¯·æ±‚ç”¨æˆ·æ‰¹å‡†è¿›è¡ŒæŸé¡¹æ•æ„Ÿæ“ä½œã€å…è®¸ç”¨æˆ·åœ¨æ¨¡åž‹è¾“å‡ºå†…å®¹çš„åŸºç¡€ä¸Šç›´æŽ¥ä¿®æ”¹å¹¶æäº¤","type":"output","group_params":[{"params":[{"key":"output_msg","label":"å‘é€æ¶ˆæ¯å†…å®¹","type":"var_textarea_file","value":{"msg":"å¥½çš„ï¼Œä½ æƒ³æ‹ä»–å“ªæ–¹é¢å‘¢ï¼ŒOpenAIï¼Ÿè¿˜æ˜¯å’Œé©¬æ–¯å…‹çš„çˆ±æ¨æƒ…ä»‡ï¼Ÿ","files":[]}},{"key":"output_way","label":"äº¤äº’ç±»åž‹","global":"value.type=input","type":"output_form","value":{"type":"","value":""},"options":[]}]}]},"measured":{"width":324,"height":465},"selected":false,"dragging":false},{"id":"llm_3c1d9","type":"flowNode","position":{"x":1610.9182544406763,"y":-629.8389075571857},"data":{"id":"llm_3c1d9","name":"å¤§æ¨¡åž‹","description":"è°ƒç”¨å¤§æ¨¡åž‹å›žç­”ç”¨æˆ·é—®é¢˜æˆ–è€…å¤„ç†ä»»åŠ¡","type":"llm","tab":{"value":"single","options":[{"label":"å•æ¬¡è¿è¡Œ","key":"single"},{"label":"æ‰¹é‡è¿è¡Œ","key":"batch"}]},"group_params":[{"params":[{"key":"batch_variable","label":"æ‰¹å¤„ç†å˜é‡","global":"self","type":"user_question","value":[],"required":true,"linkage":"output","placeholder":"è¯·é€‰æ‹©æ‰¹å¤„ç†å˜é‡","help":"é€‰æ‹©éœ€è¦æ‰¹å¤„ç†çš„å˜é‡ï¼Œå°†ä¼šå¤šæ¬¡è¿è¡Œæœ¬èŠ‚ç‚¹ï¼Œæ¯æ¬¡è¿è¡Œæ—¶ä»Žé€‰æ‹©çš„å˜é‡ä¸­å–ä¸€é¡¹èµ‹å€¼ç»™batch_variableè¿›è¡Œå¤„ç†ã€‚","tab":"batch"}]},{"name":"æ¨¡åž‹è®¾ç½®","params":[{"key":"model_id","label":"æ¨¡åž‹","type":"bisheng_model","value":58,"required":true},{"key":"temperature","label":"æ¸©åº¦","type":"slide","value":0.6}]},{"name":"æç¤ºè¯","params":[{"key":"system_prompt","label":"ç³»ç»Ÿæç¤ºè¯","type":"var_textarea","value":"ä½ æ˜¯ä¸€åæ“…é•¿å¹½é»˜æžç¬‘çš„å¦™ç¬”ç”ŸèŠ±çš„æ–‡å­¦è¯„è®ºå®¶ï¼Œè¯·å¯¹ä»¥ä¸‹æ–‡ç« æå‡º50 å­—å·¦å³çš„ä¿®æ”¹å»ºè®®æŒ‡å¯¼ï¼Œä½¿æ–‡ç« æ›´åŠ é£Žè¶£ã€‚\næ³¨æ„ï¼šä¸æ˜¯ç›´æŽ¥ç»™å‡ºä¿®æ”¹ç»“æžœï¼Œè€Œæ˜¯ç»™å‡ºä¿®æ”¹å»ºè®®ã€‚","required":true},{"key":"user_prompt","label":"ç”¨æˆ·æç¤ºè¯","type":"var_textarea","value":"æ–‡ç« å†…å®¹ï¼š{{#rag_e4299.output_input_8f3ba.user_input#}}ã€‚\nä¿®æ”¹å»ºè®®ï¼š","required":true,"varZh":{"rag_0be4c.output_input_8f3ba.user_input":"RAG/output_user_input","rag_e4299.output_input_8f3ba.user_input":"RAG/output_user_input"}}]},{"name":"è¾“å‡º","params":[{"key":"output_user","label":"å°†è¾“å‡ºç»“æžœå±•ç¤ºåœ¨ä¼šè¯ä¸­","type":"switch","help":"","value":false},{"key":"output","global":"code:value.map(el => ({ label: el.label, value: el.key }))","label":"è¾“å‡ºå˜é‡","type":"var","value":[]}]}]},"measured":{"width":324,"height":890},"selected":false,"dragging":false},{"id":"output_aa29f","type":"flowNode","position":{"x":2089.828599148091,"y":-451.0021477291829},"data":{"id":"output_aa29f","name":"è¾“å‡º2","description":"å¯å‘ç”¨æˆ·å‘é€æ¶ˆæ¯ï¼Œå¹¶ä¸”æ”¯æŒè¿›è¡Œæ›´ä¸°å¯Œçš„äº¤äº’ï¼Œä¾‹å¦‚è¯·æ±‚ç”¨æˆ·æ‰¹å‡†è¿›è¡ŒæŸé¡¹æ•æ„Ÿæ“ä½œã€å…è®¸ç”¨æˆ·åœ¨æ¨¡åž‹è¾“å‡ºå†…å®¹çš„åŸºç¡€ä¸Šç›´æŽ¥ä¿®æ”¹å¹¶æäº¤","type":"output","group_params":[{"params":[{"key":"output_msg","label":"å‘é€æ¶ˆæ¯å†…å®¹","type":"var_textarea_file","value":{"msg":"ä»¥ä¸‹æ˜¯æˆ‘å¯¹äºŽè¿™ç¯‡å½©è™¹å±çš„æ¶¦è‰²å»ºè®®ï¼Œæ‚¨å¯ä»¥åœ¨å…¶åŸºç¡€ä¸Šè¿›ä¸€æ­¥ä¿®æ”¹ï¼Œç¡®è®¤åŽæˆ‘å†è¿›è¡Œä¼˜åŒ–","files":[]}},{"key":"output_way","label":"äº¤äº’ç±»åž‹","global":"value.type=input","type":"output_form","value":{"type":"input","value":"{{#llm_3c1d9.output#}}"},"options":[],"varZh":{"llm_3c1d9.output":"å¤§æ¨¡åž‹/output"}}]}]},"measured":{"width":324,"height":618},"selected":false,"dragging":false},{"id":"llm_3695a","type":"flowNode","position":{"x":2566.5542791217986,"y":-627.7873255906729},"data":{"id":"llm_3695a","name":"å¤§æ¨¡åž‹1","description":"è°ƒç”¨å¤§æ¨¡åž‹å›žç­”ç”¨æˆ·é—®é¢˜æˆ–è€…å¤„ç†ä»»åŠ¡","type":"llm","tab":{"value":"single","options":[{"label":"å•æ¬¡è¿è¡Œ","key":"single"},{"label":"æ‰¹é‡è¿è¡Œ","key":"batch"}]},"group_params":[{"params":[{"key":"batch_variable","label":"æ‰¹å¤„ç†å˜é‡","global":"self","type":"user_question","value":[],"required":true,"linkage":"output","placeholder":"è¯·é€‰æ‹©æ‰¹å¤„ç†å˜é‡","help":"é€‰æ‹©éœ€è¦æ‰¹å¤„ç†çš„å˜é‡ï¼Œå°†ä¼šå¤šæ¬¡è¿è¡Œæœ¬èŠ‚ç‚¹ï¼Œæ¯æ¬¡è¿è¡Œæ—¶ä»Žé€‰æ‹©çš„å˜é‡ä¸­å–ä¸€é¡¹èµ‹å€¼ç»™batch_variableè¿›è¡Œå¤„ç†ã€‚","tab":"batch"}]},{"name":"æ¨¡åž‹è®¾ç½®","params":[{"key":"model_id","label":"æ¨¡åž‹","type":"bisheng_model","value":58,"required":true},{"key":"temperature","label":"æ¸©åº¦","type":"slide","value":0.6}]},{"name":"æç¤ºè¯","params":[{"key":"system_prompt","label":"ç³»ç»Ÿæç¤ºè¯","type":"var_textarea","value":"ä½ æ˜¯ä¸€åä¼˜ç§€çš„æ’°ç¨¿äººï¼Œè¯·æ ¹æ®ç¼–è¾‘çš„å®¡æ ¸æ„è§å¯¹åŽŸæ–‡è¿›è¡Œä¿®æ”¹ï¼Œè¿”å›žæ¶¦è‰²åŽçš„ç»“æžœã€‚","required":true},{"key":"user_prompt","label":"ç”¨æˆ·æç¤ºè¯","type":"var_textarea","value":"- åŽŸæ–‡ï¼š\n```{{#rag_e4299.output_input_8f3ba.user_input#}}```\n- ä¿®æ”¹å»ºè®®ï¼š\n```{{#output_aa29f.output_way#}}```\nä¿®æ”¹åŽçš„æ–‡ç« ï¼š","required":true,"varZh":{"rag_0be4c.output_input_8f3ba.user_input":"RAG/output_user_input","output_aa29f.output_way":"è¾“å‡º2/output_way","rag_e4299.output_input_8f3ba.user_input":"RAG/output_user_input"}}]},{"name":"è¾“å‡º","params":[{"key":"output_user","label":"å°†è¾“å‡ºç»“æžœå±•ç¤ºåœ¨ä¼šè¯ä¸­","type":"switch","help":"","value":true},{"key":"output","global":"code:value.map(el => ({ label: el.label, value: el.key }))","label":"è¾“å‡ºå˜é‡","type":"var","value":[]}]}]},"measured":{"width":324,"height":890},"selected":false,"dragging":false},{"id":"output_a508e","type":"flowNode","position":{"x":3074.9422422630078,"y":-27.389328075258817},"data":{"id":"output_a508e","name":"è¾“å‡º3","description":"å¯å‘ç”¨æˆ·å‘é€æ¶ˆæ¯ï¼Œå¹¶ä¸”æ”¯æŒè¿›è¡Œæ›´ä¸°å¯Œçš„äº¤äº’ï¼Œä¾‹å¦‚è¯·æ±‚ç”¨æˆ·æ‰¹å‡†è¿›è¡ŒæŸé¡¹æ•æ„Ÿæ“ä½œã€å…è®¸ç”¨æˆ·åœ¨æ¨¡åž‹è¾“å‡ºå†…å®¹çš„åŸºç¡€ä¸Šç›´æŽ¥ä¿®æ”¹å¹¶æäº¤","type":"output","group_params":[{"params":[{"key":"output_msg","label":"å‘é€æ¶ˆæ¯å†…å®¹","type":"var_textarea_file","value":{"msg":"æœ¬ workflow åˆ†æ”¯è¿è¡Œåˆ°æ­¤ç»“æŸï¼ŒæŽ¥ä¸‹æ¥è®©æˆ‘ä»¬ä½“éªŒæ¯•æ˜‡workflow çš„æˆçŽ¯èƒ½åŠ›ï¼Œæˆ‘ä»¬å°†å›žåˆ°æœ€å¼€å§‹çš„é€‰æ‹©é¢˜ï¼Œä½ å¯ä»¥å°è¯•é€‰æ‹©å¦ä¸€ä¸ªé€‰é¡¹","files":[]}},{"key":"output_way","label":"äº¤äº’ç±»åž‹","global":"value.type=input","type":"output_form","value":{"type":"","value":""},"options":[]}]}]},"measured":{"width":324,"height":481},"selected":false,"dragging":false},{"id":"llm_cc50f","type":"flowNode","position":{"x":558.4649855487039,"y":550.1339395389904},"data":{"id":"llm_cc50f","name":"å¤§æ¨¡åž‹2","description":"è°ƒç”¨å¤§æ¨¡åž‹å›žç­”ç”¨æˆ·é—®é¢˜æˆ–è€…å¤„ç†ä»»åŠ¡","type":"llm","tab":{"value":"single","options":[{"label":"å•æ¬¡è¿è¡Œ","key":"single"},{"label":"æ‰¹é‡è¿è¡Œ","key":"batch"}]},"group_params":[{"params":[{"key":"batch_variable","label":"æ‰¹å¤„ç†å˜é‡","global":"self","type":"user_question","value":[],"required":true,"linkage":"output","placeholder":"è¯·é€‰æ‹©æ‰¹å¤„ç†å˜é‡","help":"é€‰æ‹©éœ€è¦æ‰¹å¤„ç†çš„å˜é‡ï¼Œå°†ä¼šå¤šæ¬¡è¿è¡Œæœ¬èŠ‚ç‚¹ï¼Œæ¯æ¬¡è¿è¡Œæ—¶ä»Žé€‰æ‹©çš„å˜é‡ä¸­å–ä¸€é¡¹èµ‹å€¼ç»™batch_variableè¿›è¡Œå¤„ç†ã€‚","tab":"batch"}]},{"name":"æ¨¡åž‹è®¾ç½®","params":[{"key":"model_id","label":"æ¨¡åž‹","type":"bisheng_model","value":58,"required":true},{"key":"temperature","label":"æ¸©åº¦","type":"slide","value":0.6}]},{"name":"æç¤ºè¯","params":[{"key":"system_prompt","label":"ç³»ç»Ÿæç¤ºè¯","type":"var_textarea","value":"ä½ æ˜¯ä¸€åæ“…é•¿é˜´é˜³æ€ªæ°”çš„æ–‡å­¦å¤§å¸ˆï¼Œè¯·æ ¹æ®ç”¨æˆ·éœ€æ±‚å®Œæˆä¸€ç¯‡ 200 å­—çš„æ–‡ç« ã€‚","required":true},{"key":"user_prompt","label":"ç”¨æˆ·æç¤ºè¯","type":"var_textarea","value":"å†™ä¸€ç¯‡æŒ–è‹¦ Sam Altman çš„æ–‡ç« ","required":true}]},{"name":"è¾“å‡º","params":[{"key":"output_user","label":"å°†è¾“å‡ºç»“æžœå±•ç¤ºåœ¨ä¼šè¯ä¸­","type":"switch","help":"","value":true},{"key":"output","global":"code:value.map(el => ({ label: el.label, value: el.key }))","label":"è¾“å‡ºå˜é‡","type":"var","value":[]}]}]},"measured":{"width":324,"height":874},"selected":false,"dragging":false},{"id":"output_cfb3b","type":"flowNode","position":{"x":1229.2273051866277,"y":567.2249405757585},"data":{"id":"output_cfb3b","name":"è¾“å‡º4","description":"å¯å‘ç”¨æˆ·å‘é€æ¶ˆæ¯ï¼Œå¹¶ä¸”æ”¯æŒè¿›è¡Œæ›´ä¸°å¯Œçš„äº¤äº’ï¼Œä¾‹å¦‚è¯·æ±‚ç”¨æˆ·æ‰¹å‡†è¿›è¡ŒæŸé¡¹æ•æ„Ÿæ“ä½œã€å…è®¸ç”¨æˆ·åœ¨æ¨¡åž‹è¾“å‡ºå†…å®¹çš„åŸºç¡€ä¸Šç›´æŽ¥ä¿®æ”¹å¹¶æäº¤","type":"output","group_params":[{"params":[{"key":"output_msg","label":"å‘é€æ¶ˆæ¯å†…å®¹","type":"var_textarea_file","value":{"msg":"æœ¬ workflow åˆ†æ”¯è¿è¡Œåˆ°æ­¤ç»“æŸï¼Œè®©æˆ‘ä»¬å›žåˆ°æœ€å¼€å§‹çš„èµ·ç‚¹ï¼Œæ‚¨å¯ä»¥é€‰æ‹©å¦ä¸€ä¸ªé€‰é¡¹è¿›è¡Œä½“éªŒã€‚","files":[]}},{"key":"output_way","label":"äº¤äº’ç±»åž‹","global":"value.type=input","type":"output_form","value":{"type":"","value":""},"options":[]}]}]},"measured":{"width":324,"height":465},"selected":false,"dragging":false},{"id":"output_7fc98","type":"flowNode","position":{"x":140.89490001326936,"y":1121.1186250165865},"data":{"id":"output_7fc98","name":"è¾“å‡º6","description":"å¯å‘ç”¨æˆ·å‘é€æ¶ˆæ¯ï¼Œå¹¶ä¸”æ”¯æŒè¿›è¡Œæ›´ä¸°å¯Œçš„äº¤äº’ï¼Œä¾‹å¦‚è¯·æ±‚ç”¨æˆ·æ‰¹å‡†è¿›è¡ŒæŸé¡¹æ•æ„Ÿæ“ä½œã€å…è®¸ç”¨æˆ·åœ¨æ¨¡åž‹è¾“å‡ºå†…å®¹çš„åŸºç¡€ä¸Šç›´æŽ¥ä¿®æ”¹å¹¶æäº¤","type":"output","group_params":[{"params":[{"key":"output_msg","label":"å‘é€æ¶ˆæ¯å†…å®¹","type":"var_textarea_file","value":{"msg":"æˆ‘å¾ˆé—æ†¾ï¼Œçœ‹æ¥ä½ å¯¹æˆ‘å¹¶ä¸æ„Ÿå…´è¶£ï¼Œå†è§ðŸ‘‹ðŸ»","files":[]}},{"key":"output_way","label":"äº¤äº’ç±»åž‹","global":"value.type=input","type":"output_form","value":{"type":"","value":""},"options":[]}]}]},"measured":{"width":324,"height":465},"selected":false,"dragging":false},{"id":"end_3eda2","type":"flowNode","position":{"x":570,"y":1440},"data":{"id":"end_3eda2","name":"ç»“æŸ","description":"å·¥ä½œæµè¿è¡Œåˆ°æ­¤ç»“æŸ","type":"end","group_params":[]},"measured":{"width":324,"height":133}},{"id":"llm_32ef0","type":"flowNode","position":{"x":966.0583217656841,"y":1557.1325769315374},"data":{"id":"llm_32ef0","name":"å¤§æ¨¡åž‹3","description":"è°ƒç”¨å¤§æ¨¡åž‹å›žç­”ç”¨æˆ·é—®é¢˜æˆ–è€…å¤„ç†ä»»åŠ¡","type":"llm","tab":{"value":"single","options":[{"label":"å•æ¬¡è¿è¡Œ","key":"single"},{"label":"æ‰¹é‡è¿è¡Œ","key":"batch"}]},"group_params":[{"params":[{"key":"batch_variable","label":"æ‰¹å¤„ç†å˜é‡","global":"self","type":"user_question","value":[],"required":true,"linkage":"output","placeholder":"è¯·é€‰æ‹©æ‰¹å¤„ç†å˜é‡","help":"é€‰æ‹©éœ€è¦æ‰¹å¤„ç†çš„å˜é‡ï¼Œå°†ä¼šå¤šæ¬¡è¿è¡Œæœ¬èŠ‚ç‚¹ï¼Œæ¯æ¬¡è¿è¡Œæ—¶ä»Žé€‰æ‹©çš„å˜é‡ä¸­å–ä¸€é¡¹èµ‹å€¼ç»™batch_variableè¿›è¡Œå¤„ç†ã€‚","tab":"batch"}]},{"name":"æ¨¡åž‹è®¾ç½®","params":[{"key":"model_id","label":"æ¨¡åž‹","type":"bisheng_model","value":58,"required":true},{"key":"temperature","label":"æ¸©åº¦","type":"slide","value":0.6}]},{"name":"æç¤ºè¯","params":[{"key":"system_prompt","label":"ç³»ç»Ÿæç¤ºè¯","type":"var_textarea","value":"ä½ æ˜¯ä¸€ä¸ªå¤çµç²¾æ€ªçš„èŠå¤©æœºå™¨äººï¼Œæ“…é•¿æä¾›æƒ…ç»ªä»·å€¼ï¼Œè¯·é’ˆå¯¹ç”¨æˆ·çš„è¯è¯­åšå‡ºåˆé€‚çš„å›žå¤","required":true},{"key":"user_prompt","label":"ç”¨æˆ·æç¤ºè¯","type":"var_textarea","value":"{{#input_dec5a.user_input#}}","required":true,"varZh":{"input_dec5a.user_input":"è¾“å…¥1/user_input"}}]},{"name":"è¾“å‡º","params":[{"key":"output_user","label":"å°†è¾“å‡ºç»“æžœå±•ç¤ºåœ¨ä¼šè¯ä¸­","type":"switch","help":"","value":true},{"key":"output","global":"code:value.map(el => ({ label: el.label, value: el.key }))","label":"è¾“å‡ºå˜é‡","type":"var","value":[]}]}]},"measured":{"width":324,"height":874},"selected":false,"dragging":false},{"id":"output_f6a33","type":"flowNode","position":{"x":141.42148284922845,"y":1613.3057883548934},"data":{"id":"output_f6a33","name":"è¾“å‡º7","description":"å¯å‘ç”¨æˆ·å‘é€æ¶ˆæ¯ï¼Œå¹¶ä¸”æ”¯æŒè¿›è¡Œæ›´ä¸°å¯Œçš„äº¤äº’ï¼Œä¾‹å¦‚è¯·æ±‚ç”¨æˆ·æ‰¹å‡†è¿›è¡ŒæŸé¡¹æ•æ„Ÿæ“ä½œã€å…è®¸ç”¨æˆ·åœ¨æ¨¡åž‹è¾“å‡ºå†…å®¹çš„åŸºç¡€ä¸Šç›´æŽ¥ä¿®æ”¹å¹¶æäº¤","type":"output","group_params":[{"params":[{"key":"output_msg","label":"å‘é€æ¶ˆæ¯å†…å®¹","type":"var_textarea_file","value":{"msg":"æˆ‘å¯ä»¥é™ªä½ èŠå¤©ï¼Œä½†ç”±äºŽæˆ‘çš„ç ”å‘çˆ¸çˆ¸è¿˜æ²¡æœ‰å¸®æˆ‘å®žçŽ°èŠå¤©è®°å¿†åŠŸèƒ½ï¼Œæ‰€ä»¥æˆ‘ä¸ä¼šè®°å¾—ä½ ä¹‹å‰è¯´è¿‡ä»€ä¹ˆã€‚\né±¼çš„è®°å¿†æœ‰ 7 ç§’ï¼Œè€Œæˆ‘çš„è®°å¿†å´åªæœ‰ä½ çš„ä¸€å¥è¯ï¼Œè·Ÿæˆ‘è¯´ç‚¹ä»€ä¹ˆå§","files":[]}},{"key":"output_way","label":"äº¤äº’ç±»åž‹","global":"value.type=input","type":"output_form","value":{"type":"","value":""},"options":[]}]}]},"measured":{"width":324,"height":481},"selected":false,"dragging":false},{"id":"input_dec5a","type":"flowNode","position":{"x":549.7781814163795,"y":1741.6599448914053},"data":{"id":"input_dec5a","name":"è¾“å…¥1","description":"å·¥ä½œæµè¿è¡Œåˆ°æ­¤ç»“æŸ","type":"input","tab":{"value":"input","options":[{"label":"å¯¹è¯æ¡†è¾“å…¥","key":"input"},{"label":"è¡¨å•è¾“å…¥","key":"form"}]},"group_params":[{"name":"è¾“å…¥","params":[{"key":"user_input","global":"key","label":"ç”¨æˆ·è¾“å…¥çš„å†…å®¹","type":"var","tab":"input"},{"global":"code:value.map(el => ({ label: el.key, value: el.key }))","key":"form_input","label":"+ æ·»åŠ è¡¨å•é¡¹","type":"form","value":[],"tab":"form"}]}]},"measured":{"width":324,"height":268},"selected":false,"dragging":false},{"id":"rag_e4299","type":"flowNode","position":{"x":1119.8367691780427,"y":-806.9322908550855},"data":{"id":"rag_e4299","name":"RAG","description":"æ ¹æ®ç”¨æˆ·é—®é¢˜ä»ŽçŸ¥è¯†åº“ä¸­æ£€ç´¢ç›¸å…³å†…å®¹ï¼Œç»“åˆæ£€ç´¢ç»“æžœè°ƒç”¨å¤§æ¨¡åž‹ç”Ÿæˆæœ€ç»ˆç»“æžœï¼Œæ”¯æŒå¤šä¸ªé—®é¢˜å¹¶è¡Œæ‰§è¡Œã€‚","type":"rag","group_params":[{"name":"çŸ¥è¯†åº“æ£€ç´¢è®¾ç½®","params":[{"key":"user_question","label":"ç”¨æˆ·é—®é¢˜","global":"self=user_prompt","type":"user_question","required":true,"help":"","linkage":"output_user_input","value":["input_8f3ba.user_input"],"placeholder":"è¯·é€‰æ‹©ç”¨æˆ·é—®é¢˜","varZh":{"start_a030e.current_time":"å¼€å§‹/current_time","input_8f3ba.user_input":"è¾“å…¥/user_input"}},{"key":"retrieved_result","label":"æ£€ç´¢èŒƒå›´","global":"self=user_prompt","type":"knowledge_select_multi","value":{"type":"knowledge","value":[{"key":1215,"label":"Sam Altman åˆ›ä¸šæ‰‹å†Œ"}]},"required":true},{"key":"user_auth","label":"ç”¨æˆ·çŸ¥è¯†åº“æƒé™æ ¡éªŒ","type":"switch","value":false,"help":"å¼€å¯åŽï¼Œåªä¼šå¯¹ç”¨æˆ·æœ‰ä½¿ç”¨æƒé™çš„çŸ¥è¯†åº“è¿›è¡Œæ£€ç´¢ã€‚"},{"key":"max_chunk_size","label":"æ£€ç´¢ç»“æžœé•¿åº¦","type":"number","value":15000}]},{"name":"AIå›žå¤ç”Ÿæˆè®¾ç½®","params":[{"key":"system_prompt","label":"ç³»ç»Ÿæç¤ºè¯","type":"var_textarea","value":"ä½ æ˜¯ä¸€ä¸ªå¦™ç¬”ç”ŸèŠ±çš„æ–‡å­¦å¤§å¸ˆï¼Œè¯·æ ¹æ®ä»¥ä¸‹ä¸»é¢˜å†™ä¸€ç¯‡ä¸¤ç™¾å­—çš„æ–‡ç« ã€‚","required":true},{"key":"user_prompt","label":"ç”¨æˆ·æç¤ºè¯","type":"var_textarea","value":"- æ–‡ç« ä¸»é¢˜ï¼šæ­Œé¢‚ Sam Altman çš„{{#RAG/rag_e4299.user_question#}}ã€‚\n- å‚è€ƒèµ„æ–™ï¼š```{{#rag_e4299.retrieved_result#}}```","required":true,"varZh":{"RAG/rag_e4299.user_question":"RAG/user_question","RAG/rag_e4299.retrieved_result":"RAG/retrieved_result","rag_e4299.user_question":"RAG/user_question","rag_e4299.retrieved_result":"RAG/retrieved_result"}},{"key":"model_id","label":"æ¨¡åž‹","type":"bisheng_model","value":58,"required":true},{"key":"temperature","label":"æ¸©åº¦","type":"slide","value":0.6}]},{"name":"è¾“å‡º","params":[{"key":"output_user","label":"å°†è¾“å‡ºç»“æžœå±•ç¤ºåœ¨ä¼šè¯ä¸­","type":"switch","value":true},{"key":"output_user_input","label":"è¾“å‡ºå˜é‡","type":"var","global":"code:value.map(el => ({ label: el.label, value: el.key }))","value":[{"key":"output_input_8f3ba.user_input","label":"output_user_input"}]}]}]},"measured":{"width":324,"height":1110},"selected":false,"dragging":false},{"id":"output_9be96","type":"flowNode","position":{"x":91.36625734315132,"y":630.6433810079842},"data":{"id":"output_9be96","name":"è¾“å‡º5","description":"å¯å‘ç”¨æˆ·å‘é€æ¶ˆæ¯ï¼Œå¹¶ä¸”æ”¯æŒè¿›è¡Œæ›´ä¸°å¯Œçš„äº¤äº’ï¼Œä¾‹å¦‚è¯·æ±‚ç”¨æˆ·æ‰¹å‡†è¿›è¡ŒæŸé¡¹æ•æ„Ÿæ“ä½œã€å…è®¸ç”¨æˆ·åœ¨æ¨¡åž‹è¾“å‡ºå†…å®¹çš„åŸºç¡€ä¸Šç›´æŽ¥ä¿®æ”¹å¹¶æäº¤","type":"output","group_params":[{"params":[{"key":"output_msg","label":"å‘é€æ¶ˆæ¯å†…å®¹","type":"var_textarea_file","value":{"msg":"è‹±é›„æ‰€è§ç•¥åŒï¼é‚£è®©æˆ‘æ¥æ‰¹åˆ¤ä¸€ä¸‹ Sam ðŸ¤”","files":[]}},{"key":"output_way","label":"äº¤äº’ç±»åž‹","global":"value.type=input","type":"output_form","value":{"type":"","value":""},"options":[]}]}]},"measured":{"width":324,"height":465},"selected":false,"dragging":false}],"edges":[{"source":"start_a030e","sourceHandle":"right_handle","target":"output_58058","targetHandle":"left_handle","type":"customEdge","animated":true,"id":"xy-edge__start_a030eright_handle-output_58058left_handle"},{"source":"output_58058","sourceHandle":"db066c82","target":"output_ddeac","targetHandle":"left_handle","type":"customEdge","animated":true,"id":"xy-edge__output_58058db066c82-output_ddeacleft_handle"},{"source":"output_ddeac","sourceHandle":"right_handle","target":"input_8f3ba","targetHandle":"left_handle","type":"customEdge","animated":true,"id":"xy-edge__output_ddeacright_handle-input_8f3baleft_handle"},{"source":"llm_3c1d9","sourceHandle":"right_handle","target":"output_aa29f","targetHandle":"left_handle","type":"customEdge","animated":true,"id":"xy-edge__llm_3c1d9right_handle-output_aa29fleft_handle"},{"source":"output_aa29f","sourceHandle":"right_handle","target":"llm_3695a","targetHandle":"left_handle","type":"customEdge","animated":true,"id":"xy-edge__output_aa29fright_handle-llm_3695aleft_handle"},{"source":"llm_3695a","sourceHandle":"right_handle","target":"output_a508e","targetHandle":"left_handle","type":"customEdge","animated":true,"id":"xy-edge__llm_3695aright_handle-output_a508eleft_handle"},{"source":"output_a508e","sourceHandle":"right_handle","target":"output_58058","targetHandle":"left_handle","type":"customEdge","animated":true,"id":"xy-edge__output_a508eright_handle-output_58058left_handle"},{"source":"llm_cc50f","sourceHandle":"right_handle","target":"output_cfb3b","targetHandle":"left_handle","type":"customEdge","animated":true,"id":"xy-edge__llm_cc50fright_handle-output_cfb3bleft_handle"},{"source":"output_cfb3b","sourceHandle":"right_handle","target":"output_58058","targetHandle":"left_handle","type":"customEdge","animated":true,"id":"xy-edge__output_cfb3bright_handle-output_58058left_handle"},{"source":"output_58058","sourceHandle":"05289333","target":"output_7fc98","targetHandle":"left_handle","type":"customEdge","animated":true,"id":"xy-edge__output_5805805289333-output_7fc98left_handle"},{"source":"output_7fc98","sourceHandle":"right_handle","target":"end_3eda2","targetHandle":"left_handle","type":"customEdge","animated":true,"id":"xy-edge__output_7fc98right_handle-end_3eda2left_handle"},{"source":"output_58058","sourceHandle":"f138d2c3","target":"output_f6a33","targetHandle":"left_handle","type":"customEdge","animated":true,"id":"xy-edge__output_58058f138d2c3-output_f6a33left_handle"},{"source":"output_f6a33","sourceHandle":"right_handle","target":"input_dec5a","targetHandle":"left_handle","type":"customEdge","animated":true,"id":"xy-edge__output_f6a33right_handle-input_dec5aleft_handle"},{"source":"input_dec5a","sourceHandle":"right_handle","target":"llm_32ef0","targetHandle":"left_handle","type":"customEdge","animated":true,"id":"xy-edge__input_dec5aright_handle-llm_32ef0left_handle"},{"source":"llm_32ef0","sourceHandle":"right_handle","target":"input_dec5a","targetHandle":"left_handle","type":"customEdge","animated":true,"id":"xy-edge__llm_32ef0right_handle-input_dec5aleft_handle"},{"source":"input_8f3ba","sourceHandle":"right_handle","target":"rag_e4299","targetHandle":"left_handle","type":"customEdge","animated":true,"id":"xy-edge__input_8f3baright_handle-rag_e4299left_handle"},{"source":"rag_e4299","sourceHandle":"right_handle","target":"llm_3c1d9","targetHandle":"left_handle","type":"customEdge","animated":true,"id":"xy-edge__rag_e4299right_handle-llm_3c1d9left_handle"},{"source":"output_58058","sourceHandle":"6f7f86cb","target":"output_9be96","targetHandle":"left_handle","type":"customEdge","animated":true,"id":"xy-edge__output_580586f7f86cb-output_9be96left_handle"},{"source":"output_9be96","sourceHandle":"right_handle","target":"llm_cc50f","targetHandle":"left_handle","type":"customEdge","animated":true,"id":"xy-edge__output_9be96right_handle-llm_cc50fleft_handle"}],"viewport":{"x":186.14897253094978,"y":448.741224331352,"zoom":0.7445194219495764}}
export default function FlowPage() {
    // const { flow, setFlow } = useContext(TabsContext);
    // const { id } = useParams();

    // useEffect(() => {
    //     if (id && flow?.id !== id) {
    //         // åˆ‡æ¢æŠ€èƒ½é‡æ–°åŠ è½½flowæ•°æ®
    //         getFlowApi(id).then(_flow => setFlow('flow_init', _flow))
    //     }
    // }, [])

    // const [copyFlow, preFlow] = useMemo(() => {
    //     if (flow?.id === id) {
    //         const copyFlow = cloneDeep(flow)
    //         return [copyFlow, JSON.stringify(copyFlow?.data || null)] as const
    //     }
    //     return []
    // }, [flow, id])
    const { user } = useContext(userContext);


    const { flow, setFlow } = useFlowStore()

    useEffect(() => {
        const str = localStorage.getItem('flow_tmp')
        let f = str ? JSON.parse(str) : flow
        if ('workflow_test' === user.user_name) {
            f = test
        }
        setFlow(f)
        // return f
    }, [])
    return (
        <div className="flow-page-positioning">
            {flow && <Panne flow={flow} />}
        </div>
    );
}

